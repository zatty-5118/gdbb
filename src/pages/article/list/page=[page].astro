---
import Layout from '../../../layouts/Layout.astro';
import Pagination from '../../../components/modules/Pagination/Pagination.astro';
import ArticleCard from '../../../components/modules/Card/ArticleCard';
import { BASE_URL } from '../../../scripts/modules/baseURL.js';
import { array__allArticleData } from '../../../scripts/api/notionBlog.js';

export async function getStaticPaths({paginate}) {

    return paginate(array__allArticleData, {
            pageSize: 15,
        }
    );
}

const { page } = Astro.props;

const publishedArticle = page.data.filter((value) => {
  return value.published;
});

const totalPageNumber = Math.ceil(page.total / page.size);
let currentPageNumber;
currentPageNumber = page.currentPage;
let width = 1;

const paginationGenerator = () => {
  const prev = currentPageNumber - width
  const next = currentPageNumber + width + 1
  const ranges = []
  const rangeWidthDots = []
  let length;
  for (let i = 1; i <= totalPageNumber; i += 1) {
    if (i === 1 || i === totalPageNumber || (i >= prev && i <= next)) {
      ranges.push(i)
    } else if (i < prev) {
      i = prev - 1
    } else if (i > next) {
      ranges.push(totalPageNumber)
      break
    }
  }
  ranges.forEach((range) => {
    if (length) {
      if (range - length === 2) {
        rangeWidthDots.push(length + 1)
      } else if (range - length !== 1) {
        rangeWidthDots.push('...')
      }
    }
    rangeWidthDots.push(range)
    length = range
  })
  return rangeWidthDots  
}

const hierarchies = [
  {
    position : 2,
    itemName: '全てのガンプラ',
    itemPath: `${BASE_URL}/article/list/page=1`
  },
  {
    position : 3,
    itemName: `${page.currentPage}ページ目`,
    itemPath: `${BASE_URL}/article/list/page=${page.currentPage}`
  },

]

const lists = [
    { 
        name: `全てのガンプラ`,
        path: `${BASE_URL}/article/list/page=1`
    },
    {
        name: `${page.currentPage}ページ目`,
        path: `${BASE_URL}/article/list/page=${page.currentPage}`
    }
]

---

<Layout 
    title=`全てのガンプラ(${page.currentPage}ページ目) | ガンプラデータベースブログ`
    description="これまで投稿したブログの一覧ページです。"
    url=`${BASE_URL}/article/list/page=${page.currentPage}`
    hierarchies={hierarchies}
    lists={lists}
>
    <main>
        <div class="mainContents">
            <section class="title">
                <h1>全てのガンプラ</h1>
            </section>
            <section class="articleList">
                <ArticleCard articles={publishedArticle} cardType="border" client:load/>
            </section> 
            <Pagination
                totalPageNumber={totalPageNumber}
                currentPageNumber={currentPageNumber}
                paginationGenerator={paginationGenerator}
                page={page}
                BASE_URL={BASE_URL}
                category="list"
                slug=""
            />
        </div>    
    </main>
</Layout>